# 青春团缘后台管理系统

## 系统管理

### 用户管理

- 用户新增

    - 用户密码必须在5-20之间
    - 用户账号必须在2-20之间
    - 手机号和邮箱进行正则校验和前端保持一致，并进行唯一性校验
    - 不能删除超级管理员用户，不能删除自己，不能通过修改接口修改自己
    - 1.新增和修改的验证规则：用户名称，昵称，密码非空校验。用户名称唯一性校验，状态字典验证（传的值必须是字典）。
      修改的验证规则：用户名称，昵称非空校验。用户名称唯一性校验，状态字典验证（传的值必须是字典）。
      2.用户存在数据权限，账号只能查询，修改，删除 权限范围内的用户

- 用户删除

    - delflag删除标志

- 用户修改
- 用户查询

    - 用户名称和手机号支持模糊查询

- 用户导出
- 重置密码

### 角色管理

- 角色新增

    - 1.新增和修改的验证规则：角色名称，权限字符非空验证，唯一性校验。状态字典验证（传的值必须是字典）。
      2.选择角色下菜单父子联动的意思是，点击父节点只存父节点还是存父节点以及以下所有节点。
      3.删除角色检测是否被用户占用，占用不可删除
      4.不能修改和删除超级管理员角色
      5.分配用户 选择给用户批量授权或者取消授权的用户只能是权限范围内的用户

- 角色删除

    - delflag删除标志

- 角色修改
- 角色查询

    - 角色名称和权限字符支持模糊查询

- 分配用户

### 菜单管理

- 菜单新增

    - 1.新增和修改的验证规则：菜单名称，上级菜单，路由地址非空验证。菜单状态，显示状态，菜单类型， 字典验证（传的值必须是字典）。是否规则全局默认0否 1是。
      2.编辑的时候上级菜单不能是自己验证
      3.删除菜单检测是否被角色菜单表占用，占用不可删除，有子菜单不可删除

- 菜单删除
- 菜单修改
- 菜单查询

    - 菜单名称支持模糊查询

### 部门管理

- 部门新增

    - 1.新增和修改的验证规则：部门名称，上级部门，非空验证。部门状态， 字典验证（传的值必须是字典）。手机号输入进行手机号验证（前后正则保持一致）
      2.编辑的时候上级部门不能是自己验证
      3.删除部门检测是否被用户占用，占用不可删除，有子部门不可删除
      4.修改部门同时修改祖先字段，批量修改整个树结构上的部门数据
      5.用户左侧获取的部门树使用的是状态正常的部门树
      6.停用的部门 不允许添加子部门
      7.启用一个部门 会级联开启这个部门的上级部门一条线
      8.停用一个部门判断是否有下级部门未停用，有一个都不允许停用
      9.部门存在数据权限，账号只能查询，修改，删除 权限范围内的部门

- 部门删除

    - delflag删除标志

- 部门修改
- 部门查询

    - 部门名称支持模糊查询

### 字典管理

- 字典新增

    - 1.字典类型新增和修改的验证规则：字典名称，字典类型非空验证，唯一性验证。状态 字典验证（传的值必须是字典）。
      2.字典数据新增和修改的验证规则：数据标签，数据键值，非空验证。数据标签当前字典类型下唯一性验证。数据键值当前字典类型下唯一性验证。状态，字典类型： 字典验证（传的值必须是字典）
      3.字典类型下有字典数据不可删除
      4.客户端和后台使用的字典默认都是状态正常的。

- 字典删除
- 字典修改
- 字典查询

    - 字典名称和字典类型和字典标签支持模糊查询

- 刷新缓存

    - 第一次加载会在redis存储所有配置，永不过期，有缓存不走数据库。

### 参数管理

- 参数新增

    - 1.新增和修改的验证规则：参数名称，参数键名，参数键值，参数键名唯一性校验，是否系统内置默认N,是否系统内置字典校验
      2.默认内置参数不可删除

- 参数删除
- 参数修改
- 参数查询

    - 参数名称和参数键名支持模糊查询

- 刷新缓存

    - 第一次加载会在redis存储所有配置，永不过期，有缓存不走数据库。

### 日志管理

- 操作日志

    - 操作日志查询

        - 所有操作行为记录操作日志，如：新增，删除，修改，授权，导出，导入，强退，清空数据，其他。做好业务区分和模块区分
        - 系统模块和操作人员支持模糊查询

    - 操作日志清空

- 登录日志

    - 登录日志查询

        - 登录区分成功失败，锁定逻辑见登录逻辑
        - 登录地址和用户名称支持模糊查询

    - 登录日志清空

### 在线用户

- 1.根据redis里用户登录的token计算在线用户，用户token采用jwt生成，记录用户信息和登录信息
  2.可以通过强退接口 后台进行redis删除key的操作使token失效。

### 登录注册

- 登录

    - 1.根据配置决定是否使用验证码登录功能，无验证码功能不验证code参数，只验证登录账号，密码，密码数据库里采用md5加密，登录成功或者失败记录登录日志表，当连续5次登录失败锁定账号，锁定时间0.5小时，锁定逻辑也是设置在redis里设置过期时间即可。
      2.验证码生成规则：随机生成uuid，并生成图片和答案，通过uuid作为key把答案存在redis里，过期时间2分钟
      3.登录成功后 请求头里设置Authorization的key，值为Bearer 开头的token字段，用于后端需要验证登录的接口验证登录。
      4.登录过期 统一返回code：401 接口文档已说明，接口错误统一返回 code：500
      5.登录toke过期时间 30分钟

- 注册

    - 根据配置是否开启注册（暂时不做）

- 个人信息修改

    - 1.新密码不能和旧密码一样校验，
      2.密码规则同用户，手机号和邮箱规则等同用户

### 公用规则

- 1.系统所有表 共有字段  create_by 创建人  create_time 创建时间  update_by 更新人 update_time 更新时间
- 上传接口提供2种方式：1.目前的上传，前端通过接口上传文件到后端，后端调用cos等三方云存储存到云，然后返回结果给前端，2.前端通过接口请求令牌cos的一些必要参数，前端自己通过sdk上传到云存储，不经过后端（先实现1）

### 其他

- 1.树形字典考虑
- 2.行政区划管理做哪里，并且做出来需要有个同步部门的功能，默认部门初始化以行政区划划分

